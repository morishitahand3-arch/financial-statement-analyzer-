# Financial Statement Analyzer - Claude Context

## プロジェクト概要

企業の決算書（PDF形式）を分析し、財務指標を計算して分かりやすく解説するWebアプリケーション。
目的は企業理解度を深め、財務諸表を読めるようになることを支援すること。

## アーキテクチャ

### 技術スタック
- **バックエンド**: Python + Flask/FastAPI
- **PDF解析**: pdfplumber
- **データ処理**: pandas, numpy
- **フロントエンド**: HTML/CSS/JavaScript + Chart.js
- **対象**: 日本企業の財務諸表（有価証券報告書、決算短信）

### データフロー
1. ユーザーがPDFをアップロード (`frontend/templates/upload.html`)
2. `services/pdf_parser.py` でPDF解析
3. `services/data_extractor.py` で財務データ抽出
4. `models/` で構造化データに変換
5. `analyzers/` で各種分析を実行
6. `services/report_generator.py` でレポート生成
7. `frontend/templates/results.html` で結果表示

## 財務分析の知識

### 財務三表
- **貸借対照表 (B/S)**: 資産、負債、純資産
- **損益計算書 (P/L)**: 売上高、営業利益、当期純利益
- **キャッシュフロー計算書 (C/F)**: 営業CF、投資CF、財務CF

### 主要な財務指標

#### 収益性分析 (`analyzers/profitability.py`)
- **ROE (自己資本利益率)**: 当期純利益 ÷ 自己資本 × 100
  - 株主資本をどれだけ効率的に使って利益を出しているか
- **ROA (総資産利益率)**: 当期純利益 ÷ 総資産 × 100
  - 会社の資産全体の運用効率
- **売上高営業利益率**: 営業利益 ÷ 売上高 × 100
  - 本業の儲ける力

#### 安全性分析 (`analyzers/safety.py`)
- **自己資本比率**: 自己資本 ÷ 総資産 × 100
  - 30%以上が望ましい、倒産リスクの指標
- **流動比率**: 流動資産 ÷ 流動負債 × 100
  - 短期的な支払い能力
- **固定比率**: 固定資産 ÷ 自己資本 × 100
  - 100%以下が理想的

#### 成長性分析 (`analyzers/growth.py`)
- **売上高成長率**: (当期売上高 - 前期売上高) ÷ 前期売上高 × 100
- **利益成長率**: (当期利益 - 前期利益) ÷ 前期利益 × 100

#### 効率性分析 (`analyzers/efficiency.py`)
- **総資産回転率**: 売上高 ÷ 総資産
- **棚卸資産回転率**: 売上高 ÷ 棚卸資産

## 開発時の注意点

### PDF解析の課題
1. **フォーマットの多様性**: 企業ごとにPDFのレイアウトが異なる
   - テーブル構造の認識が困難な場合がある
   - OCRが必要なスキャンPDFには対応しない（初期版）
2. **データ抽出の精度**:
   - 金額の単位（千円、百万円、億円）に注意
   - カンマ区切りの数値処理
   - 括弧付き数値は負の値

### エラーハンドリング
- PDF解析失敗時は明確なエラーメッセージ
- 必須項目が欠損している場合の代替処理
- 計算時の0除算チェック

### 拡張性
- 将来的にEDINET APIからの自動取得を想定
- 複数期比較機能の追加を考慮
- 業界平均データとの比較機能

## コーディング規約

- Python: PEP 8に準拠
- 関数には型ヒント（Type Hints）を使用
- Docstringで関数の説明を記載
- 日本語コメントOK（ドメイン知識の説明）
- テストカバレッジ70%以上を目指す

## よくある質問

**Q: なぜFlaskとFastAPI両方に対応？**
A: 初期はFlaskでシンプルに、将来的に非同期処理が必要ならFastAPIに移行

**Q: データベースは使わない？**
A: 初期版はファイルベース、ユーザー認証や履歴管理が必要になったら導入

**Q: フロントエンドフレームワークは？**
A: 学習コストを下げるため、まずはバニラJSで実装。必要に応じてReact等検討
